# 4.11 Hot Water Plant

hot-water-plant:
  body: >
    @prefix p: <urn:___param___#> .
    @prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
    p:name rdf:type rdf:Alt ;
      rdf:_1 p:primary-only-plant ;
      rdf:_2 p:primary-secondary-plant .
  dependencies:
    - template: primary-only-plant
      args: {'name': 'primary-only-plant'}
    - template: primary-secondary-plant
      args: {'name': 'primary-secondary-plant'}

primary-only-plant:
  body: >
    @prefix p: <urn:___param___#> .
    @prefix brick: <https://brickschema.org/schema/Brick#> .
    @prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
    p:name a brick:Hot_Water_System ;
      brick:hasPart p:boiler,
        ( _:plant rdf:type rdf:Alt
          rdf:_1 p:constant-primary-only-loop
          rdf:_2 p:variable-primary-only-loop ) .
  optional: ['constant-primary-only-loop', 'variable-primary-only-loop']
  dependencies:
    - template: boiler
      args: {'name': 'boiler'}
    - template: constant-primary-only-loop
      args: {'name': 'constant-primary-only-loop'}
    - template: variable-primary-only-loop
      args: {'name': 'variable-primary-only-loop'}

primary-secondary-plant:
  body: >
    @prefix p: <urn:___param___#> .
    @prefix brick: <https://brickschema.org/schema/Brick#> .
    @prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
    p:name a brick:Hot_Water_System ;
      brick:hasPart p:boiler,
        ( _:plant rdf:type rdf:Alt
          rdf:_1 p:constant-primary-constant-secondary-loop
          rdf:_2 p:constant-primary-variable-secondary-loop
          rdf:_3 p:variable-primary-constant-secondary-loop
          rdf:_4 p:variable-primary-variable-secondary-loop ) .
  optional: [
    'constant-primary-constant-secondary-loop',
    'constant-primary-variable-secondary-loop',
    'variable-primary-constant-secondary-loop',
    'variable-primary-variable-secondary-loop'
  ]
  dependencies:
    - template: boiler
      args: {'name': 'boiler'}
    - template: constant-primary-constant-secondary-loop
      args: {'name': 'constant-primary-constant-secondary-loop'}
    - template: constant-primary-variable-secondary-loop
      args: {'name': 'constant-primary-variable-secondary-loop'}
    - template: variable-primary-constant-secondary-loop
      args: {'name': 'variable-primary-constant-secondary-loop'}
    - template: variable-primary-variable-secondary-loop
      args: {'name': 'variable-primary-variable-secondary-loop'}

# 4.11.1 Boilers

boiler:
  body: >
    @prefix p: <urn:___param___#> .
    @prefix brick: <https://brickschema.org/schema/Brick#> .
    p:name a brick:Boiler ;
      brick:hasPart p:isolation-valve ;
      brick:hasPoint p:enable, p:hws-temp-setpt, p:firing-rate, p:nat-gas-flow .
  optional: ['firing-rate', 'isolation-valve', 'nat-gas-flow']
  dependencies:
    - template: isolation-valve
      args: {'name': 'isolation-valve'}
    - template: https://brickschema.org/schema/Brick#On_Off_Command
      library: https://brickschema.org/schema/1.3/Brick
      args: {'name': 'enable'}
    - template: https://brickschema.org/schema/Brick#Leaving_Hot_Water_Temperature_Setpoint
      library: https://brickschema.org/schema/1.3/Brick
      args: {'name': 'hws-temp-setpt'}
    - template: https://brickschema.org/schema/Brick#Valve_Position_Sensor
      library: https://brickschema.org/schema/1.3/Brick
      args: {'name': 'firing-rate'}
    - template: https://brickschema.org/schema/Brick#Valve_Status
      library: https://brickschema.org/schema/1.3/Brick
      args: {'name': 'nat-gas-flow'}

isolation-valve:
  body: >
    @prefix p: <urn:___param___#> .
    @prefix brick: <https://brickschema.org/schema/Brick#> .
    p:name a brick:Isolation_Valve ;
      brick:hasPoint p:iso-valve, p:closed-end-switch, p:open-end-switch .
  optional: ['closed-switch', 'open-switch']
  dependencies:
    - template: https://brickschema.org/schema/Brick#On_Off_Command
      library: https://brickschema.org/schema/1.3/Brick
      args: {'name': 'iso-valve'}
    - template: https://brickschema.org/schema/Brick#On_Status
      library: https://brickschema.org/schema/1.3/Brick
      args: {'name': 'closed-end-switch'}
    - template: https://brickschema.org/schema/Brick#Off_Status
      library: https://brickschema.org/schema/1.3/Brick
      args: {'name': 'open-end-switch'}

# 4.11.2 HW Pumps (see components.yml)

# 4.11.3 Primary (only) HW Loop

primary-only-loop:
  body: >
    @prefix p: <urn:___param___#> .
    @prefix brick: <https://brickschema.org/schema/Brick#> .
    @prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
    p:name a brick:Hot_Water_Loop ;
      brick:hasPoint
        ( _:point rdf:type rdf:Alt
          rdf:_1 p:hws-flow
          rdf:_2 p:hwr-flow ),
        p:hws-temp, p:gauge-pressure .
  optional: ['gauge-pressure']
  dependencies:
    - template: https://brickschema.org/schema/Brick#Leaving_Hot_Water_Flow_Sensor
      library: https://brickschema.org/schema/1.3/Brick
      args: {'name': 'hws-flow'}
    - template: https://brickschema.org/schema/Brick#Entering_Hot_Water_Flow_Sensor
      library: https://brickschema.org/schema/1.3/Brick
      args: {'name': 'hwr-flow'}
    - template: https://brickschema.org/schema/Brick#Leaving_Hot_Water_Temperature_Sensor
      library: https://brickschema.org/schema/1.3/Brick
      args: {'name': 'hws-temp'}
    - template: https://brickschema.org/schema/Brick#Pressure_Sensor
      library: https://brickschema.org/schema/1.3/Brick
      args: {'name': 'gauge-pressure'}

constant-primary-only-loop:
  body: >
    @prefix p: <urn:___param___#> .
    @prefix brick: <https://brickschema.org/schema/Brick#> .
    p:name a p:primary-only-loop ;
      brick:hasPart p:constant-speed-pump .
  dependencies:
    - template: primary-only-loop
      args: {'name': 'primary-only-loop'}
    - template: constant-speed-pump
      args: {'name': 'constant-speed-pump'}

# TODO check syntax for loop hwr temp
variable-primary-only-loop:
  body: >
    @prefix p: <urn:___param___#> .
    @prefix brick: <https://brickschema.org/schema/Brick#> .
    p:name a p:primary-only-loop ;
      brick:feeds ( p:demand-loop brick:hasPoint p:loop-hwr-temp ) ;
      brick:hasPart p:variable-speed-pump, p:min-flow-bypass-valve ;
      brick:hasPoint p:plant-hwr-temp .
  optional: ['loop-hwr-temp']
  dependencies:
    - template: primary-only-loop
      args: {'name': 'primary-only-loop'}
    - template: https://brickschema.org/schema/Brick#Hot_Water_Loop
      library: https://brickschema.org/schema/1.3/Brick
      args: {'name': 'demand-loop'}
    - template: variable-speed-pump
      args: {'name': 'variable-speed-pump'}
    - template: min-flow-bypass-valve
      args: {'name': 'min-flow-bypass-valve'}
    - template: https://brickschema.org/schema/Brick#Entering_Hot_Water_Flow_Sensor
      library: https://brickschema.org/schema/1.3/Brick
      args: {'name': 'loop-hwr-temp'}
    - template: https://brickschema.org/schema/Brick#Entering_Hot_Water_Flow_Sensor
      library: https://brickschema.org/schema/1.3/Brick
      args: {'name': 'plant-hwr-temp'}

# 4.11.4 (Primary) Secondary HW Loop

# common points from 4.11.3
primary-loop:
  body: >
    @prefix p: <urn:___param___#> .
    @prefix brick: <https://brickschema.org/schema/Brick#> .
    p:name a brick:Hot_Water_Loop ;
      brick:hasPoint p:hws-temp, p:hwr-temp, p:gauge-pressure .
  optional: ['hws-temp', 'gauge-pressure']
  dependencies:
    - template: https://brickschema.org/schema/Brick#Leaving_Hot_Water_Temperature_Sensor
      library: https://brickschema.org/schema/1.3/Brick
      args: {'name': 'hws-temp'}
    - template: https://brickschema.org/schema/Brick#Entering_Hot_Water_Temperature_Sensor
      library: https://brickschema.org/schema/1.3/Brick
      args: {'name': 'hwr-temp'}
    - template: https://brickschema.org/schema/Brick#Pressure_Sensor
      library: https://brickschema.org/schema/1.3/Brick
      args: {'name': 'gauge-pressure'}

constant-primary-loop:
  body: >
    @prefix p: <urn:___param___#> .
    @prefix brick: <https://brickschema.org/schema/Brick#> .
    p:name a p:primary-loop ;
      brick:hasPart p:constant-speed-pump .
  dependencies:
    - template: primary-loop
      args: {'name': 'primary-loop'}
    - template: constant-speed-pump
      args: {'name': 'constant-speed-pump'}

variable-primary-loop:
  body: >
    @prefix p: <urn:___param___#> .
    @prefix brick: <https://brickschema.org/schema/Brick#> .
    p:name a p:primary-loop ;
      brick:hasPart p:variable-speed-pump .
  dependencies:
    - template: primary-loop
      args: {'name': 'primary-loop'}
    - template: variable-speed-pump
      args: {'name': 'variable-speed-pump'}

secondary-loop:
  body: >
    @prefix p: <urn:___param___#> .
    @prefix brick: <https://brickschema.org/schema/Brick#> .
    @prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
    p:name a brick:Hot_Water_Loop ;
      brick:hasPoint p:sec-hws-temp, p:sec-hwr-temp,
        ( _:point rdf:type rdf:Alt
          rdf:_1 p:sec-hws-flow
          rdf:_2 p:sec-hwr-flow ),
        p:int-hws-temp .
  optional: ['sec-hws-flow', 'sec-hwr-flow', 'int-hws-temp']
  dependencies:
    - template: https://brickschema.org/schema/Brick#Leaving_Hot_Water_Temperature_Sensor
      library: https://brickschema.org/schema/1.3/Brick
      args: {'name': 'sec-hws-temp'}
    - template: https://brickschema.org/schema/Brick#Entering_Hot_Water_Temperature_Sensor
      library: https://brickschema.org/schema/1.3/Brick
      args: {'name': 'sec-hwr-temp'}
    - template: https://brickschema.org/schema/Brick#Leaving_Hot_Water_Flow_Sensor
      library: https://brickschema.org/schema/1.3/Brick
      args: {'name': 'sec-hws-flow'}
    - template: https://brickschema.org/schema/Brick#Entering_Hot_Water_Flow_Sensor
      library: https://brickschema.org/schema/1.3/Brick
      args: {'name': 'sec-hwr-flow'}
    - template: https://brickschema.org/schema/Brick#Leaving_Hot_Water_Temperature_Sensor
      library: https://brickschema.org/schema/1.3/Brick
      args: {'name': 'int-hws-temp'}

constant-secondary-loop:
  body: >
    @prefix p: <urn:___param___#> .
    @prefix brick: <https://brickschema.org/schema/Brick#> .
    p:name a p:secondary-loop ;
      brick:hasPart p:constant-speed-pump .
  dependencies:
    - template: secondary-loop
      args: {'name': 'secondary-loop'}
    - template: constant-speed-pump
      args: {'name': 'constant-speed-pump'}

variable-secondary-loop:
  body: >
    @prefix p: <urn:___param___#> .
    @prefix brick: <https://brickschema.org/schema/Brick#> .
    p:name a p:secondary-loop ;
      brick:hasPart p:variable-speed-pump .
  dependencies:
    - template: secondary-loop
      args: {'name': 'secondary-loop'}
    - template: variable-speed-pump
      args: {'name': 'variable-speed-pump'}

constant-primary-constant-secondary-loop:
  body: >
    @prefix p: <urn:___param___#> .
    @prefix brick: <https://brickschema.org/schema/Brick#> .
    p:name a brick:Hot_Water_Loop ;
      brick:hasPart ( p:constant-primary-loop brick:feeds p:constant-secondary-loop ) .
  dependencies:
    - template: constant-primary-loop
      args: {'name': 'constant-primary-loop'}
    - template: constant-secondary-loop
      args: {'name': 'constant-secondary-loop'}

constant-primary-variable-secondary-loop:
  body: >
    @prefix p: <urn:___param___#> .
    @prefix brick: <https://brickschema.org/schema/Brick#> .
    @prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
    p:name a brick:Hot_Water_Loop ;
      brick:hasPart
        ( p:constant-primary-loop brick:feeds p:variable-secondary-loop ) ;
          brick:hasPoint
            ( _:point rdf:type rdf:Alt
              rdf:_1 p:hws-flow
              rdf:_2 p:hwr-flow ) .
  dependencies:
    - template: constant-primary-loop
      args: {'name': 'constant-primary-loop'}
    - template: variable-secondary-loop
      args: {'name': 'variable-secondary-loop'}
    - template: https://brickschema.org/schema/Brick#Leaving_Hot_Water_Flow_Sensor
      library: https://brickschema.org/schema/1.3/Brick
      args: {'name': 'hws-flow'}
    - template: https://brickschema.org/schema/Brick#Entering_Hot_Water_Flow_Sensor
      library: https://brickschema.org/schema/1.3/Brick
      args: {'name': 'hwr-flow'}

variable-primary-constant-secondary-loop:
  body: >
    @prefix p: <urn:___param___#> .
    @prefix brick: <https://brickschema.org/schema/Brick#> .
    p:name a brick:Hot_Water_Loop ;
      brick:hasPart ( p:variable-primary-loop brick:feeds p:constant-secondary-loop ) .
  dependencies:
    - template: variable-primary-loop
      args: {'name': 'variable-primary-loop'}
    - template: constant-secondary-loop
      args: {'name': 'constant-secondary-loop'}

variable-primary-variable-secondary-loop:
  body: >
    @prefix p: <urn:___param___#> .
    @prefix brick: <https://brickschema.org/schema/Brick#> .
    @prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
    p:name a brick:Hot_Water_Loop ;
      brick:hasPart
        ( p:variable-primary-loop brick:feeds p:variable-secondary-loop ) ;
          brick:hasPoint
            ( _:point rdf:type rdf:Alt
              rdf:_1 p:hws-flow
              rdf:_2 p:hwr-flow ),
            p:decoupler-flow .
  optional: ['hws-flow', 'hwr-flow', 'decoupler-flow']
  dependencies:
    - template: variable-primary-loop
      args: {'name': 'variable-primary-loop'}
    - template: variable-secondary-loop
      args: {'name': 'variable-secondary-loop'}
    - template: https://brickschema.org/schema/Brick#Leaving_Hot_Water_Flow_Sensor
      library: https://brickschema.org/schema/1.3/Brick
      args: {'name': 'hws-flow'}
    - template: https://brickschema.org/schema/Brick#Entering_Hot_Water_Flow_Sensor
      library: https://brickschema.org/schema/1.3/Brick
      args: {'name': 'hwr-flow'}
    - template: https://brickschema.org/schema/Brick#Hot_Water_Flow_Sensor
      library: https://brickschema.org/schema/1.3/Brick
      args: {'name': 'decoupler-flow'}