@prefix brick: <https://brickschema.org/schema/Brick#> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix vav41: <urn:ashrae/g36/4.1/vav-cooling-only/> .
@prefix vav42: <urn:ashrae/g36/4.2/vav-with-reheat/> .
@prefix bmotif: <https://nrel.gov/BuildingMOTIF#> .
@prefix : <urn:ashrae/g36/components/> .

# Air-Side

:cooling_damper a sh:NodeShape, owl:Class, bmotif:System_Specification ;
    sh:class brick:Damper ;
    rdfs:label "Cooling Damper" ;
    sh:property [
        sh:path brick:hasPoint ;
        sh:qualifiedValueShape [ sh:class brick:Damper_Position_Command ] ;
        sh:qualifiedMinCount 1 ;
        sh:qualifiedMaxCount 1 ;
    ] ;
.

:heating_damper a sh:NodeShape, owl:Class, bmotif:System_Specification ;
    sh:class brick:Damper ;
    rdfs:label "Heating Damper" ;
    sh:property [
        sh:path brick:hasPoint ;
        sh:qualifiedValueShape [ sh:class brick:Damper_Position_Command ] ;
        sh:qualifiedMinCount 1 ;
        sh:qualifiedMaxCount 1 ;
    ] ;
.

# component of 4.6, 4.7, 4.8, 4.12
:supply-fan a sh:NodeShape, owl:Class, bmotif:HVAC ;
    rdfs:label "Supply Fan" ;
    sh:class brick:Supply_Fan ;
    # motor
    sh:property [
        sh:path brick:hasPart ;
        sh:qualifiedValueShape [ sh:node :fan-motor ] ;
        sh:qualifiedMinCount 1 ;
        sh:qualifiedMaxCount 1 ;
    ] .

:fan-motor a sh:NodeShape, owl:Class, bmotif:HVAC ;
    rdfs:label "Fan Motor" ;
    sh:class brick:Motor ;
    # required for all
    sh:property [
        rdfs:label "Fan start/stop" ;
        sh:path brick:hasPoint ;
        sh:qualifiedValueShape [ sh:class brick:Start_Stop_Command ] ;
        sh:qualifiedMinCount 1 ;
        sh:qualifiedMaxCount 1 ;
    ] ;
    # required for all
    sh:property [
        rdfs:label "Fan speed" ;
        sh:path brick:hasPoint ;
        sh:qualifiedValueShape [ sh:class brick:Fan_Speed_Command ] ;
        sh:qualifiedMinCount 1 ;
        sh:qualifiedMaxCount 1 ;
    ] ;
    # optional for all, assuming 4.7 which is blank in 2021 follows the other AHUs
    sh:property [
        rdfs:label "Fan status" ;
        sh:path brick:hasPoint ;
        sh:qualifiedValueShape [ sh:class brick:Fan_Status ] ;
        sh:qualifiedMinCount 0 ;
        sh:qualifiedMaxCount 1 ;
    ] .

# component of 4.6, 4.7, 4.8, 4.12
:filter a sh:NodeShape, owl:Class, bmotif:HVAC ;
    rdfs:label "Filter" ;
    sh:class brick:Filter ;
    # optional for all
    sh:property [
        rdfs:label "Filter pressure drop" ;
        sh:path brick:hasPoint ;
        sh:qualifiedValueShape [ sh:class brick:Differential_Pressure_Sensor ] ;
        sh:qualifiedMinCount 0 ;
        sh:qualifiedMaxCount 1 ;
    ] .

# component of 4.6, 4.8, 4.12
:cooling-coil a sh:NodeShape, owl:Class, bmotif:HVAC ;
    rdfs:label "Cooling Coil" ;
    sh:class brick:Cooling_Coil ;
    # required for all (application-specific)
    sh:property [
        rdfs:label "Cooling signal" ;
        sh:path brick:hasPoint ;
        sh:qualifiedValueShape [ sh:class brick:Cooling_Command ] ;
        sh:qualifiedMinCount 1 ;
        sh:qualifiedMaxCount 1 ;
    ] .

# component of 4.2, 4.3, 4.7 (required)
# component of 4.6, 4.8, 4.12 (application-specific)
# NOTE guideline is inconsistent for cases when htg coils are not a component
:heating-coil a sh:NodeShape, owl:Class, bmotif:HVAC ;
    rdfs:label "Heating Coil" ;
    sh:class brick:Heating_Coil ;
    # required for all
    sh:property [
        rdfs:label "Heating signal" ;
        sh:path brick:hasPoint ;
        sh:qualifiedValueShape [ sh:class brick:Heating_Command ] ;
        sh:qualifiedMinCount 1 ;
        sh:qualifiedMaxCount 1 ;
    ] .

# component of 4.1, 4.2, 4.3, 4.4, 4.5, 4.8, 4.12
:thermostat a sh:NodeShape, owl:Class, bmotif:HVAC ;
    rdfs:label "Thermostat" ;
    sh:class brick:Thermostat ;
    # required for all
    sh:property [
        rdfs:label "Zone temperature" ;
        sh:path brick:hasPoint ;
        sh:qualifiedValueShape [ sh:class brick:Zone_Air_Temperature_Sensor ] ;
        sh:qualifiedMinCount 1 ;
        sh:qualifiedMaxCount 1 ;
    ] ;
    # application-specific for all
    sh:property [
        rdfs:label "Local override" ;
        sh:path brick:hasPoint ;
        sh:qualifiedValueShape [ sh:class brick:Override_Command ] ;
        sh:qualifiedMinCount 0 ;
        sh:qualifiedMaxCount 1 ;
    ] ;
    # application-specific for all
    sh:property [
        rdfs:label "Zone temperature setpoint adjustment" ;
        sh:path brick:hasPoint ;
        sh:qualifiedValueShape [ sh:class brick:Differential_Air_Temperature_Setpoint ] ;
        sh:qualifiedMinCount 0 ;
        sh:qualifiedMaxCount 1 ;
    ] .

# component of 4.1, 4.2, 4.3, 4.4, 4.5, 4.8, 4.12 (systems serving a single zone)
# NOTE may need to clarify cases for zones containing rooms and relationship to points
:zone a sh:NodeShape, owl:Class, bmotif:HVAC ;
    rdfs:label "HVAC Zone" ;
    sh:class brick:HVAC_Zone ;
    # application-specific for all
    sh:property [
        rdfs:label "Occupancy sensor" ;
        sh:path brick:hasPoint ;
        sh:qualifiedValueShape [ sh:class brick:Occupancy_Sensor ] ;
        sh:qualifiedMinCount 0 ;
        sh:qualifiedMaxCount 1 ;
    ] ;
    # application-specific for all
    sh:property [
        rdfs:label "Window switch" ;
        sh:path brick:hasPoint ;
        sh:qualifiedValueShape [ sh:class brick:Open_Close_Status ] ;
        sh:qualifiedMinCount 0 ;
        sh:qualifiedMaxCount 1 ;
    ] ;
    # application-specific for all
    sh:property [
        rdfs:label "Zone CO2 level" ;
        sh:path brick:hasPoint ;
        sh:qualifiedValueShape [ sh:class brick:CO2_Level_Sensor ] ;
        sh:qualifiedMinCount 0 ;
        sh:qualifiedMaxCount 1 ;
    ] .

# Water-Side

# Pumps
# components of 4.10.2, 4.10.5, 4.11.2

:constant-speed-pump-motor a sh:NodeShape, owl:Class, bmotif:HVAC ;
    rdfs:label "Constant Speed Pump Motor" ;
    sh:class brick:Motor ;
    # required
    sh:property [
        rdfs:label "Pump Start" ;
        sh:path brick:hasPoint ;
        sh:qualifiedValueShape [ sh:class brick:On_Command ] ;
        sh:qualifiedMinCount 1 ;
        sh:qualifiedMaxCount 1 ;
    ] ;
    # required
    sh:property [
        rdfs:label "Pump Status" ;
        sh:path brick:hasPoint ;
        sh:qualifiedValueShape [ sh:class brick:On_Off_Status ] ;
        sh:qualifiedMinCount 1 ;
        sh:qualifiedMaxCount 1 ;
    ] .

:variable-speed-pump-motor a sh:NodeShape, owl:Class, bmotif:HVAC ;
    rdfs:label "Variable Speed Pump Motor" ;
    sh:class brick:Variable_Frequency_Drive ;
    # required
    sh:property [
        rdfs:label "Pump Start" ;
        sh:path brick:hasPoint ;
        sh:qualifiedValueShape [ sh:class brick:On_Command ] ;
        sh:qualifiedMinCount 1 ;
        sh:qualifiedMaxCount 1 ;
    ] ;
    # required
    sh:property [
        rdfs:label "Pump Status" ;
        sh:path brick:hasPoint ;
        sh:qualifiedValueShape [ sh:class brick:On_Off_Status ] ;
        sh:qualifiedMinCount 1 ;
        sh:qualifiedMaxCount 1 ;
    ] ;
    # application-specific, required for VFDs
    sh:property [
        rdfs:label "Pump Speed" ;
        rdfs:comment "Provide one speed point for each group of variable speed pumps controlled to the same speed (e.g. all primary pumps or all secondary pumps, if applicable). Speed point not required for constant speed pumps." ;
        sh:path brick:hasPoint ;
        sh:qualifiedValueShape [ sh:class brick:Speed_Command ] ;
        sh:qualifiedMinCount 1 ;
        sh:qualifiedMaxCount 1 ;
    ] ;
    # optional
    sh:property [
        rdfs:label "Alarm" ;
        sh:path brick:hasPoint ;
        sh:qualifiedValueShape [ sh:class brick:Fault_Status ] ;
        sh:qualifiedMinCount 0 ;
        sh:qualifiedMaxCount 1 ;
    ] .

:constant-speed-pump a sh:NodeShape, owl:Class, bmotif:HVAC ;
    rdfs:label "Constant Speed Pump" ;
    sh:class brick:Pump ;
    sh:property [
        sh:path brick:hasPart ;
        sh:qualifiedValueShape [ sh:node :constant-speed-pump-motor ] ;
        sh:qualifiedMinCount 1 ;
        sh:qualifiedMaxCount 1 ;
    ] ;
    # application-specific
    # TODO required for pump(s) serving multiple control valves
    sh:property [
        rdfs:label "Differential Pressure" ;
        sh:path brick:hasPoint ;
        sh:qualifiedValueShape [ sh:class brick:Differential_Pressure_Sensor ] ;
        sh:qualifiedMinCount 0 ;
        sh:qualifiedMaxCount 1 ;
    ] .

:variable-speed-pump a sh:NodeShape, owl:Class, bmotif:HVAC ;
    rdfs:label "Variable Speed Pump" ;
    sh:class brick:Pump ;
    # TODO hasPart might not be the correct relationship for a pump with a VFD, which is a separate piece of equipment
    sh:property [
        sh:path brick:hasPart ;
        sh:qualifiedValueShape [ sh:node :variable-speed-pump-motor ] ;
        sh:qualifiedMinCount 1 ;
        sh:qualifiedMaxCount 1 ;
    ] ;
    # application-specific
    # TODO required for pump(s) serving multiple control valves
    sh:property [
        rdfs:label "Differential Pressure" ;
        sh:path brick:hasPoint ;
        sh:qualifiedValueShape [ sh:class brick:Differential_Pressure_Sensor ] ;
        sh:qualifiedMinCount 0 ;
        sh:qualifiedMaxCount 1 ;
    ] .

# Loops

# component of 4.10.3 and 4.11.3
:min-flow-bypass-valve a sh:NodeShape, owl:Class, bmotif:HVAC ;
    sh:class brick:Bypass_Valve ;
    # applications, required if present
    sh:property [
        rdfs:label "Min Flow Bypass Valve" ;
        sh:path brick:hasPoint ;
        sh:qualifiedValueShape [ sh:class brick:Valve_Position_Command ] ;
        sh:qualifiedMinCount 1 ;
        sh:qualifiedMinCount 1 ;
    ] .
